[#server-setup]
Red Hat SSO のインストールが完了したので、Red Hat SSO における重要な概念である Realm (レルム) の説明と、ログイン画面によくある機能の例としてユーザー登録の設定を行います。


[#what-is-realm]
=== Realm (レルム) とは何か
Red Hat SSO の基本的な設定をする前に Realm (レルム) とは何かを説明します。

レルムとは、特定のグループ・アプリケーション・サービスに関するすべての設定やオプションのための論理的な名前空間です。
レルムでは一連のユーザー・アプリケーション・登録されたアイデンティティブローカー・クライアントなどのセキュリティメタデータを保護し管理します。

ユーザーは、Red Hat SSO の管理コンソール (Admin Console) において、特定のレルム内に作成することができます。
ロール (権限) はレルムレベルで定義することができ、これらのロールを特定のユーザーに割り当てるために、ユーザーロールマッピングを設定することもできます。
ユーザーは、レルムに所属しており、レルムにログインすることができます。
レルムは互いに隔離されており、自分が管理するユーザーのみを管理・認証することができます。

image::realm.png[Realm]

[#master-realm]
=== マスターレルム （Master Realm）
マスターレルムとは、Red Hat SSO の初期レルムを指しています。
これはレルムの階層構造の中で最も高いレベルです。このレルムの管理者アカウントは、Red Hat SSO のサーバーインスタンス上に作成された他のレルムを参照・管理する権限を持ちます。
初期管理者アカウントを定義するとき、マスターレルムにアカウントを作成します。管理コンソールへの最初のログインもマスターレルム経由になります。

組織内のユーザーとアプリケーションを管理するために、マスターレルムを使用しないことが推奨されています。
マスターレルムを使用するのは、システム内のレルムを作成し管理する最上位の管理者のみに限定してください。
このセキュリティモデルに従うと、偶発的な変更を防ぐことができ、ユーザーアカウントにタスクの実行に必要な権限のみを許可することができます。

マスターレルムを無効にし、新規作成したレルムごとに管理者アカウントを定義することも可能です。
各レルムには専用の管理コンソールがあり、ローカルアカウントでログインすることができます。


[#user-registration]
=== ユーザー登録
Red Hat SSO では、ログイン画面によくある機能の例としてユーザー登録機能を追加することができます。

Red Hat SSO の管理コンソールから `Demojs` レルムの `Login` タブをクリックします。

image::sso_login.png[Login]

`User Registration` を有効にし、`Save` をクリックします。

image::sso_login2.png[Login2]

Red Hat SSO には、アカウント管理画面があり、そこからアカウントを登録します。

* アカウント管理画面: https://sso-{{ USER_ID }}-keycloak.{{ ROUTE_SUBDOMAIN }}/auth/realms/demojs/account

アカウント管理画面の右上の `Sing-in` をクリックすると、 ログイン画面が表示されます。

image::sso_siginin.png[siginin]

`register` をクリックしてください。

image::sso_siginin2.png[siginin2]

ユーザ登録画面が表示されます。各項目を適当に入力してください。(メールアドレスはhoge@hogeのようにドメインが必要です)

image::sso_siginin3.png[siginin3]

これでユーザー登録を行い、登録したユーザーで Demojs レルムにログインすることができました。

image::sso_siginin4.png[siginin4]

これで Red Hat SSO サーバーのユーザ登録ができました。
次の章では、Quarkusアプリケーションをデプロイし、Red Hat SSO を用いてシングルサインオンを実現するように設定します。
